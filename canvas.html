<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的画板</title>
</head>
<style>
    #xxx {
        background: white;
    }

    canvas {
        display: block;
    }

    body {
        margin: 0;
    }

    .actions {
        position: fixed;
        padding: 20px;
        top: 0;
        left: 0;

    }

    .actions svg {
        transition: all 0.4s;

    }

    .actions svg.active {
        fill: red;
        transform: scale(1.2);
    }

    .icon {
        width: 2em;
        height: 2em;
        vertical-align: -0.15em;
        fill: currentColor;
        overflow: hidden;
    }
</style>

<body>
    <canvas id="xxx" width="300" height="300"></canvas>
    <div id="actions" class="actions x">
        <svg id="brush" class="icon active">
            <use xlink:href="#icon-brush"></use>
        </svg>
        <svg id="eraser" class="icon">
            <use xlink:href="#icon-eraser-ps"></use>
        </svg>
    </div>
    <script>
        var yyy = document.getElementById('xxx');//声明
        var context = yyy.getContext('2d')//调用API,查看MDN文档

        autoSetCanvasSize(yyy)


        /*****/
        var using = false;
        var lastPoint = { x: undefined, y: undefined }

        if (document.body.ontouchstart !== undefined) {
            //触屏设备 null
            yyy.ontouchstart = function (aaa) {
                var x = aaa.touches[0].clientX
                var y = aaa.touches[0].clientY
                if (eraserEnabled) {
                    using = true
                    context.clearRect(x - 5, y - 5, 10, 10)
                } else {
                    using = true
                    lastPoint = { "x": x, "y": y }
                }
            }
            yyy.ontouchmove = function (aaa) {
                var x = aaa.touches[0].clientX
                var y = aaa.touches[0].clientY;
                if (!using) { return }
                if (eraserEnabled) {
                    if (using) {
                        context.clearRect(x - 5, y - 5, 10, 10)
                    }
                } else {
                    if (using) {
                        using = true
                        var newPoint = { "x": x, "y": y }
                        drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
                        lastPoint = newPoint;
                    }

                }
            }
            yyy.ontouchend = function () {
                using = false
            }

        } else {
            //非触屏设备
            yyy.onmousedown = function (aaa) {
                var x = aaa.clientX
                var y = aaa.clientY
                using = true
                if (eraserEnabled) {
                    context.clearRect(x, y, 10, 10)
                } else {
                    lastPoint = { "x": x, "y": y }
                }
                yyy.onmousemove = function (aaa) {
                    var x = aaa.clientX
                    var y = aaa.clientY
                    if (eraserEnabled) {
                        if (using) {
                            using = true
                            context.clearRect(x - 5, y - 5, 10, 10)
                        }
                    } else {
                        if (using) {
                            using = true
                            var newPoint = { "x": x, "y": y }
                            drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
                            lastPoint = newPoint;
                        }
                    }
                }

                // drawCircle(x, y, 1)
            }
            yyy.onmouseup = function (aaa) {
                using = false
            }
        }

        function drawLine(x1, y1, x2, y2) {
            context.beginPath()
            context.moveTo(x1, y1)
            context.lineWidth = 1
            context.lineTo(x2, y2)
            context.stroke()
            context.closePath()
        }
        /********************/
        var eraserEnabled = false
        eraser.onclick = function () {
            eraserEnabled = true
            eraser.classList.add('active')
            brush.classList.remove('active')
        }
        brush.onclick = function () {
            eraserEnabled = false
            brush.classList.add('active')
            eraser.classList.remove('active')
        }


        /********/

        function autoSetCanvasSize(canvas) {
            setCanvasSize()
            window.onresize = function () {
                setCanvasSize()
            }

            function setCanvasSize() {
                var pageWidth = document.documentElement.clientWidth;
                var pageHeight = document.documentElement.clientHeight;
                canvas.width = pageWidth;
                canvas.height = pageHeight;
            }
        }

    </script>
    <script src="//at.alicdn.com/t/font_1124906_jh3ap0tfcdc.js"></script>
</body>

</html>